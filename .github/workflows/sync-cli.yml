name: Sync SeeYouUI to CLI

on:
  push:
    branches: [main]

jobs:
  sync-code:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout 源仓库 see-u-ui
      - name: Checkout source (see-u-ui)
        uses: actions/checkout@v4
        with:
          path: source

      # 2️⃣ Checkout 目标仓库 see-u-ui-cli
      - name: Checkout target (see-u-ui-cli)
        uses: actions/checkout@v4
        with:
          repository: seeyouui/see-u-ui-cli
          token: ${{ secrets.SYNC_TOKEN }}
          path: target
          ref: main

      # 3️⃣ 同步文件（排除必需的 Git 和 workflows）
      - name: Sync all files
        run: |
          echo "开始同步所有文件..."

          rsync -av --delete \
            --exclude '.git/' \
            --exclude '.github/workflows/' \
            source/ target/src/

          echo "同步完成，准备提交..."

      # 4️⃣ 提交并推送
      - name: Commit and Push
        working-directory: target
        run: |
          git config user.name "GitHub Action Bot"
          git config user.email "action@github.com"

          git add .

          if git diff --staged --quiet; then
            echo "没有变化。"
            exit 0
          fi

          git commit -m "同步 see-u-ui $(date +'%Y-%m-%d %H:%M:%S')"
          git push origin main
          echo "推送成功！"
